{% load static %}
   <section class="content-area main-section">
        <div class="coreshelf">
            <!-- Player de Vídeo -->
            <video id="videoPlayer" controls playsinline webkit-playsinline class="hidden-player">
                <source src="{% static 'videos/1.mp4' %}" type="video/mp4">
                Seu navegador não suporta a tag de vídeo.
            </video>
            
            <!-- Visualizador de Imagem -->
            <div id="imageViewer" class="hidden-player">
                <img src="" alt="Visualizador de Imagem">
            </div>
            
            <!-- Player de Áudio Customizado -->
            <div id="customAudioPlayer" class="hidden-player">
                <audio id="audioPlayer" playsinline webkit-playsinline>
                    <source src="" type="audio/mpeg">
                    Seu navegador não suporta a tag de áudio.
                </audio>
                <div class="audio-controls">
                    <div class="audio-info">
                        <h4 id="audioTitle">Nome do Áudio</h4>
                        <div class="audio-thumbnail">
                            <img id="audioThumbnail" src="" alt="Thumbnail">
                        </div>
                    </div>
                    <div class="audio-main-controls">
                        <button id="playPauseBtn" class="control-btn">
                            <i class="fas fa-play"></i>
                        </button>
                        <div class="audio-progress-container">
                            <span id="currentTime">0:00</span>
                            <div class="audio-progress-bar">
                                <div id="audioProgress" class="audio-progress-fill"></div>
                            </div>
                            <span id="totalTime">0:00</span>
                        </div>
                        <div class="audio-speed-controls">
                            <button class="speed-btn" data-speed="1">1x</button>
                            <button class="speed-btn" data-speed="1.5">1.5x</button>
                            <button class="speed-btn" data-speed="2">2x</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Botão de reprodução automática -->
        <div style="text-align: center; margin: 15px 0;">
            <button id="autoPlayBtn" class="auto-play-button" title="Toque todos os itens dessa busca" alt="Toque todos os itens dessa busca">
                <i class="fas fa-play"></i>
                <span>Toque todos os itens dessa busca</span>
            </button>
        </div>
        
        <style>
            .auto-play-button {
                padding: 12px 24px;
                background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 1rem;
                font-weight: 500;
                cursor: pointer;
                display: inline-flex;
                align-items: center;
                gap: 10px;
                box-shadow: 0 4px 12px rgba(44, 62, 80, 0.3);
                transition: all 0.3s ease;
            }
            .auto-play-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(44, 62, 80, 0.4);
                background: linear-gradient(135deg, #1a252f 0%, #2c3e50 100%);
            }
            .auto-play-button:active {
                transform: translateY(0);
            }
            .auto-play-button.playing {
                background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            }
            .auto-play-button.playing:hover {
                background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
            }
            .auto-play-button i {
                font-size: 1.1rem;
            }
        </style>
        
        <div class="video-shelf">
            <h3>Prateleira</h3>
   
                <div style="margin-bottom: 5px;">
                    <label for="search-input" style="font-weight: 500; color: #555; font-size: 0.9rem; margin-bottom: 5px; display: block;">Pesquise um termo ou data</label>
                    <form method="get" action="" class="search-bar" id="main-search-form">
                        <input type="text" id="search-input" name="search" placeholder="Buscar por nome ou data (yyyy-mm-dd)" value="{{ search_query }}">
                        {% for tag in selected_tags %}
                        <input type="hidden" name="tags" value="{{ tag }}">
                        {% endfor %}
                        {% if tag_operator %}
                        <input type="hidden" name="tag_operator" value="{{ tag_operator }}">
                        {% endif %}
                        <button type="submit"><i class="fas fa-search"></i></button>
                    </form>
                </div>
                
                <div style="margin-top: 15px;">
                    <label for="tag-search-input" style="font-weight: 500; color: #555; font-size: 0.9rem; margin-bottom: 5px; display: block;">Tags</label>
                    <form method="get" action="" class="tag-search-bar" style="position: relative;">
                        <input type="hidden" name="search" value="{{ search_query }}">
                        {% for tag in selected_tags %}
                        <input type="hidden" name="tags" value="{{ tag }}">
                        {% endfor %}
                        {% if tag_operator %}
                        <input type="hidden" name="tag_operator" value="{{ tag_operator }}">
                        {% endif %}
                        <input type="text" 
                               id="tag-search-input"
                               name="tag" 
                               placeholder="Buscar por tag" 
                               value="" 
                               autocomplete="off">
                        <button type="submit" style="display: none;"><i class="fas fa-tag"></i></button>
                        <div id="tag-autocomplete" class="tag-autocomplete-dropdown"></div>
                    </form>
                </div>
                
                <!-- Tags selecionadas -->
                <div id="selected-tags-container" class="selected-tags-container" style="margin-top: 10px;">
                    {% if selected_tags %}
                        {% for tag in selected_tags %}
                        <div class="selected-tag" data-tag="{{ tag }}">
                            <i class="fas fa-tag"></i> {{ tag }}
                            <button type="button" class="remove-tag-btn" onclick="removeTag('{{ tag }}')" title="Remover tag">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        {% endfor %}
                        
                        <!-- Switch AND/OR -->
                        <div class="tag-operator-switch" style="display: flex; align-items: center; gap: 8px; margin-left: 10px;">
                            <label class="switch-label" style="display: flex; align-items: center; gap: 5px; font-size: 0.85rem; color: #666;">
                                <span class="operator-text" style="font-weight: 500;">{{ tag_operator|upper }}</span>
                                <div class="toggle-switch" onclick="toggleOperator()">
                                    <input type="checkbox" id="operator-toggle" {% if tag_operator == 'and' %}checked{% endif %} style="display: none;">
                                    <span class="toggle-slider"></span>
                                </div>
                            </label>
                        </div>
                    {% endif %}
                </div>
                
                {% if top_tags %}
                <div class="top-tags-suggestions" style="margin: 15px 0; display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
                    <span style="font-size: 0.9rem; color: #666; font-weight: 500;">Tags populares:</span>
                    {% for tag in top_tags %}
                    <a href="?tags={{ tag.name|urlencode }}{% if search_query %}&search={{ search_query|urlencode }}{% endif %}{% for t in selected_tags %}&tags={{ t|urlencode }}{% endfor %}{% if tag_operator %}&tag_operator={{ tag_operator }}{% endif %}" 
                       class="tag-suggestion"
                       style="padding: 5px 12px; background: #e3f2fd; color: #1976d2; text-decoration: none; border-radius: 15px; font-size: 0.85rem; transition: all 0.2s;">
                        <i class="fas fa-tag" style="font-size: 0.75rem;"></i> {{ tag.name }} <span style="opacity: 0.7;">({{ tag.countUses }})</span>
                    </a>
                    {% endfor %}
                </div>
                <style>
                    .tag-suggestion:hover {
                        background: #1976d2;
                        color: white;
                        transform: scale(1.05);
                    }
                    .tag-search-bar {
                        display: flex;
                        gap: 5px;
                        position: relative;
                    }
                    .tag-search-bar input[type="text"] {
                        flex: 1;
                        padding: 8px 12px;
                        border: 2px solid #ddd;
                        border-radius: 4px;
                        font-size: 1rem;
                    }
                    .tag-search-bar button {
                        padding: 8px 16px;
                        background: #1976d2;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        cursor: pointer;
                        transition: background 0.2s;
                    }
                    .tag-search-bar button:hover {
                        background: #1565c0;
                    }
                    .tag-autocomplete-dropdown {
                        position: absolute;
                        top: 100%;
                        left: 0;
                        right: 50px;
                        background: white;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                        max-height: 250px;
                        overflow-y: auto;
                        z-index: 1000;
                        display: none;
                        margin-top: 2px;
                    }
                    .tag-autocomplete-dropdown.active {
                        display: block;
                    }
                    .tag-autocomplete-item {
                        padding: 10px 12px;
                        cursor: pointer;
                        border-bottom: 1px solid #f0f0f0;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        transition: background 0.2s;
                    }
                    .tag-autocomplete-item:last-child {
                        border-bottom: none;
                    }
                    .tag-autocomplete-item:hover,
                    .tag-autocomplete-item.selected {
                        background: #e3f2fd;
                    }
                    .tag-autocomplete-item .tag-name {
                        font-weight: 500;
                        color: #333;
                    }
                    .tag-autocomplete-item .tag-count {
                        font-size: 0.85rem;
                        color: #666;
                        background: #f5f5f5;
                        padding: 2px 8px;
                        border-radius: 10px;
                    }
                    .tag-autocomplete-loading {
                        padding: 10px;
                        text-align: center;
                        color: #666;
                    }
                    .tag-autocomplete-empty {
                        padding: 10px;
                        text-align: center;
                        color: #999;
                    }
                    .selected-tags-container {
                        display: flex;
                        gap: 8px;
                        flex-wrap: wrap;
                        align-items: center;
                    }
                    .selected-tags-container:empty {
                        display: none;
                    }
                    .selected-tag {
                        display: inline-flex;
                        align-items: center;
                        gap: 6px;
                        padding: 6px 10px;
                        background: #1976d2;
                        color: white;
                        border-radius: 20px;
                        font-size: 0.9rem;
                        font-weight: 500;
                        box-shadow: 0 2px 4px rgba(25, 118, 210, 0.3);
                    }
                    .selected-tag i.fa-tag {
                        font-size: 0.8rem;
                    }
                    .remove-tag-btn {
                        background: rgba(255, 255, 255, 0.2);
                        border: none;
                        color: white;
                        width: 18px;
                        height: 18px;
                        border-radius: 50%;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        padding: 0;
                        transition: background 0.2s;
                    }
                    .remove-tag-btn:hover {
                        background: rgba(255, 255, 255, 0.4);
                    }
                    .remove-tag-btn i {
                        font-size: 0.7rem;
                    }
                    .tag-operator-switch {
                        display: inline-flex;
                        align-items: center;
                    }
                    .toggle-switch {
                        position: relative;
                        display: inline-block;
                        width: 40px;
                        height: 20px;
                        cursor: pointer;
                    }
                    .toggle-slider {
                        position: absolute;
                        cursor: pointer;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background-color: #4CAF50;
                        transition: .3s;
                        border-radius: 20px;
                    }
                    .toggle-slider:before {
                        position: absolute;
                        content: "";
                        height: 14px;
                        width: 14px;
                        left: 3px;
                        bottom: 3px;
                        background-color: white;
                        transition: .3s;
                        border-radius: 50%;
                    }
                    #operator-toggle:checked + .toggle-slider {
                        background-color: #2196F3;
                    }
                    #operator-toggle:checked + .toggle-slider:before {
                        transform: translateX(20px);
                    }
                    .operator-text {
                        min-width: 30px;
                        text-align: center;
                    }
                </style>
                
                <script>
                // Função global para remover tag
                function removeTag(tagName) {
                    const urlParams = new URLSearchParams(window.location.search);
                    const tags = urlParams.getAll('tags');
                    
                    // Remover a tag específica
                    urlParams.delete('tags');
                    tags.filter(t => t !== tagName).forEach(t => urlParams.append('tags', t));
                    
                    // Preservar termo de busca se existir
                    const searchTerm = urlParams.get('search');
                    if (searchTerm) {
                        urlParams.set('search', searchTerm);
                    }
                    
                    const newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');
                    window.location.href = newUrl;
                }
                
                // Função global para alternar operador
                function toggleOperator() {
                    const urlParams = new URLSearchParams(window.location.search);
                    const currentOperator = urlParams.get('tag_operator') || 'or';
                    const newOperator = currentOperator === 'or' ? 'and' : 'or';
                    
                    urlParams.set('tag_operator', newOperator);
                    
                    // Preservar termo de busca se existir
                    const searchTerm = urlParams.get('search');
                    if (searchTerm) {
                        urlParams.set('search', searchTerm);
                    }
                    
                    const newUrl = window.location.pathname + '?' + urlParams.toString();
                    window.location.href = newUrl;
                }
                
                (function() {
                    const input = document.getElementById('tag-search-input');
                    const dropdown = document.getElementById('tag-autocomplete');
                    const selectedTagsContainer = document.getElementById('selected-tags-container');
                    let debounceTimer;
                    let selectedIndex = -1;
                    let currentResults = [];
                    
                    if (!input || !dropdown) return;
                    
                    // Função para buscar tags
                    async function searchTags(query) {
                        if (query.length < 1) {
                            hideDropdown();
                            return;
                        }
                        
                        try {
                            const response = await fetch(`/api/tags/?search=${encodeURIComponent(query)}`);
                            if (!response.ok) throw new Error('Erro ao buscar tags');
                            
                            const data = await response.json();
                            currentResults = data.results || data;
                            displayResults(currentResults);
                        } catch (error) {
                            console.error('Erro ao buscar tags:', error);
                            dropdown.innerHTML = '<div class="tag-autocomplete-empty">Erro ao buscar tags</div>';
                            dropdown.classList.add('active');
                        }
                    }
                    
                    // Função para exibir resultados
                    function displayResults(results) {
                        if (results.length === 0) {
                            dropdown.innerHTML = '<div class="tag-autocomplete-empty">Nenhuma tag encontrada</div>';
                            dropdown.classList.add('active');
                            return;
                        }
                        
                        dropdown.innerHTML = results.map((tag, index) => `
                            <div class="tag-autocomplete-item" data-index="${index}" data-tag="${tag.name}">
                                <span class="tag-name"><i class="fas fa-tag"></i> ${tag.name}</span>
                                <span class="tag-count">${tag.countUses} usos</span>
                            </div>
                        `).join('');
                        
                        dropdown.classList.add('active');
                        selectedIndex = -1;
                        
                        // Adicionar eventos de click
                        dropdown.querySelectorAll('.tag-autocomplete-item').forEach(item => {
                            item.addEventListener('click', function() {
                                selectTag(this.dataset.tag);
                            });
                        });
                    }
                    
                    // Função para selecionar tag
                    function selectTag(tagName) {
                        // Limpar input
                        input.value = '';
                        hideDropdown();
                        
                        // Adicionar tag aos parâmetros da URL (sem remover as existentes)
                        const urlParams = new URLSearchParams(window.location.search);
                        const existingTags = urlParams.getAll('tags');
                        
                        // Verificar se a tag já não foi adicionada
                        if (!existingTags.includes(tagName)) {
                            urlParams.append('tags', tagName);
                        }
                        
                        // Preservar termo de busca se existir
                        const searchTerm = urlParams.get('search');
                        if (searchTerm) {
                            urlParams.set('search', searchTerm);
                        }
                        
                        const newUrl = window.location.pathname + '?' + urlParams.toString();
                        window.location.href = newUrl;
                    }
                    
                    // Função para esconder dropdown
                    function hideDropdown() {
                        dropdown.classList.remove('active');
                        selectedIndex = -1;
                    }
                    
                    // Função para navegar com teclado
                    function navigateResults(direction) {
                        const items = dropdown.querySelectorAll('.tag-autocomplete-item');
                        if (items.length === 0) return;
                        
                        // Remover seleção anterior
                        if (selectedIndex >= 0 && selectedIndex < items.length) {
                            items[selectedIndex].classList.remove('selected');
                        }
                        
                        // Atualizar índice
                        if (direction === 'down') {
                            selectedIndex = (selectedIndex + 1) % items.length;
                        } else {
                            selectedIndex = selectedIndex <= 0 ? items.length - 1 : selectedIndex - 1;
                        }
                        
                        // Adicionar nova seleção
                        items[selectedIndex].classList.add('selected');
                        items[selectedIndex].scrollIntoView({ block: 'nearest' });
                    }
                    
                    // Event listener para input
                    input.addEventListener('input', function(e) {
                        clearTimeout(debounceTimer);
                        const query = e.target.value.trim();
                        
                        if (query.length === 0) {
                            hideDropdown();
                            return;
                        }
                        
                        dropdown.innerHTML = '<div class="tag-autocomplete-loading"><i class="fas fa-spinner fa-spin"></i> Buscando...</div>';
                        dropdown.classList.add('active');
                        
                        debounceTimer = setTimeout(() => {
                            searchTags(query);
                        }, 300);
                    });
                    
                    // Event listener para teclas
                    input.addEventListener('keydown', function(e) {
                        const items = dropdown.querySelectorAll('.tag-autocomplete-item');
                        
                        if (!dropdown.classList.contains('active') || items.length === 0) {
                            return;
                        }
                        
                        switch(e.key) {
                            case 'ArrowDown':
                                e.preventDefault();
                                navigateResults('down');
                                break;
                            case 'ArrowUp':
                                e.preventDefault();
                                navigateResults('up');
                                break;
                            case 'Enter':
                                e.preventDefault();
                                if (selectedIndex >= 0 && selectedIndex < items.length) {
                                    selectTag(items[selectedIndex].dataset.tag);
                                }
                                break;
                            case 'Escape':
                                hideDropdown();
                                break;
                        }
                    });
                    
                    // Fechar dropdown ao clicar fora
                    document.addEventListener('click', function(e) {
                        if (!input.contains(e.target) && !dropdown.contains(e.target)) {
                            hideDropdown();
                        }
                    });
                })();
                </script>
                {% endif %}
            
            <!-- Seletor de itens por página -->
            <div class="pagination-controls">
                <label for="items-per-page">Itens por página:</label>
                <select id="items-per-page" name="per_page" onchange="changeItemsPerPage(this.value)">
                    <option value="2" {% if items_per_page == 15 %}selected{% endif %}>15</option>
                    <option value="30" {% if items_per_page == 30 %}selected{% endif %}>30</option>
                    <option value="45" {% if items_per_page == 45 %}selected{% endif %}>45</option>
                </select>
            </div>
            
            <div class="item-grid">
                {% for file in files %}
                <div class="item-card" data-extension="{{ file.extension }}" data-file-url="{% if file.file %}{{ file.file.url }}{% endif %}" data-file-id="{{ file.id }}">
                    {% if file.thumbnail %}
                        <img src="{{ file.thumbnail.url }}" alt="{{ file.name }}">
                    {% else %}
                        <img src="{% static 'img/default-thumbnail.svg' %}" alt="{{ file.name }}">
                    {% endif %}
                    <h4>{{ file.name }}</h4>
                    <p>
                        <small>
                            {% if file.visibility == 'public' %}
                                <i class="fas fa-globe" alt="Público"></i> {{ file.user.username }}
                            {% elif file.visibility == 'users' %}
                                <i class="fas fa-users" alt="Usuários"></i> {{ file.user.username }}
                            {% else %}
                                <i class="fas fa-lock" alt="Privado"></i> {{ file.user.username }}
                            {% endif %}
                            | {{ file.size|filesizeformat }}
                        </small>
                    </p>
                    {% if file.user == request.user %}
                        <i class="fas check-icon" title="Seu arquivo"></i>
                        <a href="{% url 'edit_file' file.id %}" class="edit-file-btn" onclick="event.stopPropagation();">
                            <i class="fas fa-edit"></i> Editar
                        </a>
                    {% endif %}
                </div>
                {% empty %}
                <div class="item-card" style="grid-column: 1 / -1; text-align: center; padding: 2rem;">
                    <p>Nenhum arquivo encontrado</p>
                </div>
                {% endfor %}
            </div>
            
            <!-- Paginação -->
            {% if files.has_other_pages %}
            <div class="pagination">
                {% if files.has_previous %}
                    <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% for tag in selected_tags %}&tags={{ tag }}{% endfor %}{% if tag_operator %}&tag_operator={{ tag_operator }}{% endif %}&per_page={{ items_per_page }}">&laquo; Primeira</a>
                    <a href="?page={{ files.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% for tag in selected_tags %}&tags={{ tag }}{% endfor %}{% if tag_operator %}&tag_operator={{ tag_operator }}{% endif %}&per_page={{ items_per_page }}">Anterior</a>
                {% else %}
                    <span class="disabled">&laquo; Primeira</span>
                    <span class="disabled">Anterior</span>
                {% endif %}
                
                {% for num in files.paginator.page_range %}
                    {% if files.number == num %}
                        <span class="current-page">{{ num }}</span>
                    {% elif num > files.number|add:'-3' and num < files.number|add:'3' %}
                        <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% for tag in selected_tags %}&tags={{ tag }}{% endfor %}{% if tag_operator %}&tag_operator={{ tag_operator }}{% endif %}&per_page={{ items_per_page }}">{{ num }}</a>
                    {% endif %}
                {% endfor %}
                
                {% if files.has_next %}
                    <a href="?page={{ files.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% for tag in selected_tags %}&tags={{ tag }}{% endfor %}{% if tag_operator %}&tag_operator={{ tag_operator }}{% endif %}&per_page={{ items_per_page }}">Próxima</a>
                    <a href="?page={{ files.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% for tag in selected_tags %}&tags={{ tag }}{% endfor %}{% if tag_operator %}&tag_operator={{ tag_operator }}{% endif %}&per_page={{ items_per_page }}">Última &raquo;</a>
                {% else %}
                    <span class="disabled">Próxima</span>
                    <span class="disabled">Última &raquo;</span>
                {% endif %}
            </div>
            {% endif %}
<script>
// Função para mudar itens por página
function changeItemsPerPage(value) {
    const url = new URL(window.location.href);
    url.searchParams.set('per_page', value);
    url.searchParams.set('page', '1'); // Voltar para a primeira página
    window.location.href = url.toString();
}

// Sistema de reprodução automática de itens
(function() {
    const autoPlayBtn = document.getElementById('autoPlayBtn');
    const videoPlayer = document.getElementById('videoPlayer');
    const audioPlayer = document.getElementById('audioPlayer');
    const imageViewer = document.getElementById('imageViewer');
    
    let isAutoPlaying = false;
    let currentIndex = 0;
    let itemCards = [];
    let imageTimeout = null;
    
    if (!autoPlayBtn) return;
    
    // Função para obter categoria do arquivo
    function getFileCategory(extension) {
        if (!extension) return null;
        const ext = extension.toLowerCase();
        for (const [category, extensions] of Object.entries(extFiles)) {
            if (extensions.includes(ext)) {
                return category;
            }
        }
        return null;
    }
    
    // Função para parar reprodução automática
    function stopAutoPlay() {
        isAutoPlaying = false;
        currentIndex = 0;
        
        // Limpar timeout de imagem
        if (imageTimeout) {
            clearTimeout(imageTimeout);
            imageTimeout = null;
        }
        
        // Remover event listeners
        if (videoPlayer) {
            videoPlayer.removeEventListener('ended', playNext);
        }
        if (audioPlayer) {
            audioPlayer.removeEventListener('ended', playNext);
        }
        
        // Atualizar botão
        autoPlayBtn.classList.remove('playing');
        autoPlayBtn.innerHTML = '<i class="fas fa-play"></i><span>Toque todos os itens dessa busca</span>';
        
        console.log('Reprodução automática parada');
    }
    
    // Função para reproduzir próximo item
    function playNext() {
        if (!isAutoPlaying) return;
        
        currentIndex++;
        
        if (currentIndex >= itemCards.length) {
            console.log('Todos os itens foram reproduzidos');
            stopAutoPlay();
            return;
        }
        
        playItem(currentIndex);
    }
    
    // Função para reproduzir um item específico
    function playItem(index) {
        if (index >= itemCards.length) {
            stopAutoPlay();
            return;
        }
        
        const card = itemCards[index];
        const extension = card.dataset.extension;
        const fileUrl = card.dataset.fileUrl;
        const category = getFileCategory(extension);
        
        console.log(`Reproduzindo item ${index + 1}/${itemCards.length}: ${extension} (${category})`);
        
        // Limpar timeout anterior se existir
        if (imageTimeout) {
            clearTimeout(imageTimeout);
            imageTimeout = null;
        }
        
        // Simular clique no card para abrir o player
        card.click();
        
        // Aguardar um pouco para o player carregar
        setTimeout(() => {
            if (category === 'video') {
                // Para vídeos, esperar terminar
                if (videoPlayer && !videoPlayer.classList.contains('hidden-player')) {
                    videoPlayer.removeEventListener('ended', playNext);
                    videoPlayer.addEventListener('ended', playNext, { once: true });
                    videoPlayer.play().catch(err => {
                        console.error('Erro ao reproduzir vídeo:', err);
                        playNext();
                    });
                } else {
                    playNext();
                }
            } else if (category === 'audio') {
                // Para áudios, esperar terminar
                if (audioPlayer && !audioPlayer.paused) {
                    audioPlayer.removeEventListener('ended', playNext);
                    audioPlayer.addEventListener('ended', playNext, { once: true });
                } else {
                    playNext();
                }
            } else if (category === 'image') {
                // Para imagens, mostrar por 10 segundos
                console.log('Imagem será exibida por 10 segundos');
                imageTimeout = setTimeout(() => {
                    playNext();
                }, 10000);
            } else {
                // Para outros tipos, pular
                console.log('Tipo não suportado, pulando...');
                setTimeout(playNext, 500);
            }
        }, 500);
    }
    
    // Iniciar reprodução automática
    function startAutoPlay() {
        // Coletar todos os item-cards
        itemCards = Array.from(document.querySelectorAll('.item-card')).filter(card => {
            return card.dataset.extension && card.dataset.fileUrl;
        });
        
        if (itemCards.length === 0) {
            alert('Nenhum item disponível para reprodução');
            return;
        }
        
        console.log(`Iniciando reprodução automática de ${itemCards.length} itens`);
        
        isAutoPlaying = true;
        currentIndex = 0;
        
        // Atualizar botão
        autoPlayBtn.classList.add('playing');
        autoPlayBtn.innerHTML = '<i class="fas fa-stop"></i><span>Parar reprodução automática</span>';
        
        // Iniciar com o primeiro item
        playItem(0);
    }
    
    // Event listener do botão
    autoPlayBtn.addEventListener('click', function() {
        if (isAutoPlaying) {
            stopAutoPlay();
        } else {
            startAutoPlay();
        }
    });
    
    // Parar se o usuário navegar para outra página
    window.addEventListener('beforeunload', function() {
        if (isAutoPlaying) {
            stopAutoPlay();
        }
    });
})();
</script>